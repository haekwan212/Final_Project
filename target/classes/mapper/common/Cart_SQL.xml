<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cart">

	<select id="sessionCartList" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT A.GOODS_NAME, A.GOODS_PRICE, A.GOODS_DCPRICE, A.GOODS_THUMBNAIL,
			A.GOODS_CATEGORY1, A.GOODS_CATEGORY2, A.GOODS_SALEDATE, A.GOODS_NUMBER,
			C.GOODS_AMOUNT, C.GOODS_SIZE, C.GOODS_COLOR, C.GOODS_KINDS_NUMBER
			FROM GOODS A, GOODS_KINDS C
			WHERE A.GOODS_NUMBER= #{GOODS_NUMBER} AND C.GOODS_KINDS_NUMBER=#{GOODS_KINDS_NUMBER}
			AND A.GOODS_ONOFF=0
		]]>
	</select>

	<select id="confirmCart" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT * FROM CART 
			WHERE GOODS_KINDS_NUMBER=#{GOODS_KINDS_NUMBER} AND MEMBER_NUMBER=#{MEMBER_NUMBER}
		]]>
	</select>
	
	<select id="selectOption" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT A.CART_NUMBER, A.GOODS_NUMBER, A.GOODS_KINDS_NUMBER, A.CART_AMOUNT,
			C.GOODS_NAME, C.GOODS_PRICE, C.GOODS_DCPRICE, C.GOODS_THUMBNAIL, C.GOODS_SALEDATE,
			D.GOODS_SIZE, D.GOODS_AMOUNT, D.GOODS_COLOR
			FROM CART A, GOODS C, GOODS_KINDS D
			WHERE A.GOODS_NUMBER=C.GOODS_NUMBER AND A.GOODS_KINDS_NUMBER=D.GOODS_KINDS_NUMBER
			AND CART_NUMBER=#{CART_NUMBER}
		]]>
	</select>
	
	<select id="sessionOption" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT C.GOODS_NUMBER, D.GOODS_KINDS_NUMBER,
			C.GOODS_NAME, C.GOODS_PRICE, C.GOODS_DCPRICE, C.GOODS_THUMBNAIL,
			D.GOODS_SIZE, D.GOODS_AMOUNT, D.GOODS_COLOR, C.GOODS_SALEDATE
			FROM GOODS C, GOODS_KINDS D
			WHERE C.GOODS_NUMBER=D.GOODS_NUMBER                      
			AND D.GOODS_KINDS_NUMBER=#{GOODS_KINDS_NUMBER}
		]]>
	</select>

	<insert id="insertCart" parameterType="hashmap"
		useGeneratedKeys="true" keyProperty="CART_NUMBER">
		<selectKey keyProperty="CART_NUMBER" resultType="integer"
			order="BEFORE">
			SELECT CART_NUMBER_SEQ.NEXTVAL FROM DUAL
		</selectKey>
		<![CDATA[
			INSERT INTO CART ( 
			CART_NUMBER, MEMBER_NUMBER, GOODS_NUMBER, CART_REGDATE,
			CART_AMOUNT, GOODS_KINDS_NUMBER
			 ) VALUES ( 
			#{CART_NUMBER}, #{MEMBER_NUMBER}, #{GOODS_NUMBER}, SYSDATE,
			#{CART_AMOUNT}, #{GOODS_KINDS_NUMBER} )
		]]>
	</insert>

	<!-- on되어있는 상품만, 등록 시간이 3일 이하인 상품만 -->
	<select id="selectMyCart" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT DISTINCT A.GOODS_NUMBER, A.CART_NUMBER, A.MEMBER_NUMBER,
			A.CART_REGDATE, A.CART_AMOUNT, A.GOODS_KINDS_NUMBER, E.GOODS_AMOUNT,
			E.GOODS_SIZE, E.GOODS_COLOR, E.GOODS_KINDS_NUMBER,
			D.GOODS_NAME, D.GOODS_PRICE, D.GOODS_DCPRICE, D.GOODS_SALEDATE,
			D.GOODS_THUMBNAIL,D.GOODS_CATEGORY1, D.GOODS_CATEGORY2
			FROM CART A, GOODS D, GOODS_KINDS E WHERE A.MEMBER_NUMBER=#{MEMBER_NUMBER}
			AND A.CART_REGDATE>SYSDATE-3
			AND A.GOODS_KINDS_NUMBER=E.GOODS_KINDS_NUMBER
			AND A.GOODS_NUMBER=D.GOODS_NUMBER AND D.GOODS_ONOFF=0
			ORDER BY A.CART_REGDATE DESC, A.GOODS_NUMBER ASC
		]]>
	</select>
	
	<update id="updateCarts" parameterType="hashmap">
		<![CDATA[
			UPDATE CART SET CART_AMOUNT=#{CART_AMOUNT}, CART_REGDATE=SYSDATE
			WHERE CART_NUMBER=#{CART_NUMBER}
		]]>
	</update>

	<!-- 로그인할 때 등록기간 3일 이상 상품 지우기 -->
	<delete id="deleteCarts" parameterType="hashmap">
		<![CDATA[
			DELETE FROM CART WHERE CART_REGDATE<SYSDATE-3 AND MEMBER_NUMBER=#{MEMBER_NUMBER}
		]]>
	</delete>

	<!-- cart 해제 -->
	<delete id="deleteMyCart" parameterType="hashmap">
		<![CDATA[
			DELETE FROM CART WHERE CART_NUMBER=#{CART_NUMBER}
		]]>
	</delete>




</mapper>