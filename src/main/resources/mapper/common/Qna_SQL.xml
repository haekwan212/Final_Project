<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="qna">
	<select id="qnalistByNumber" parameterType="String" resultType="hashmap">
	<![CDATA[
	  select A.QNA_NUMBER, A.GOODS_NUMBER, A.GOODS_NAME, A.GOODS_THUMBNAIL, A.QNA_TITLE, A.QNA_CONTENT, A.QNA_REGDATE, A.QNA_REPSTATE, A.QNA_REPCONTENT, A.QNA_REPDATE
		FROM (select * from goods natural join qna) A WHERE QNA_CATEGORY = '상품문의' AND MEMBER_NUMBER = #{MEMBER_NUMBER}  AND ( QNA_REPSTATE = '답변대기' OR QNA_REPSTATE = '답변완료') 
		GROUP BY A.QNA_NUMBER, A.GOODS_NUMBER, A.GOODS_NAME, A.GOODS_THUMBNAIL, A.QNA_TITLE, A.QNA_CONTENT, A.QNA_REGDATE, A.QNA_REPSTATE, A.QNA_REPCONTENT, A.QNA_REPDATE ORDER BY QNA_REGDATE DESC
	]]>
	</select>
	<select id="qnalistByNumber2" parameterType="String" resultType="hashmap">
	<![CDATA[
	  select A.QNA_NUMBER, A.GOODS_NUMBER, A.GOODS_NAME, A.GOODS_THUMBNAIL, A.QNA_TITLE, A.QNA_CONTENT, A.QNA_REGDATE, A.QNA_REPSTATE, A.QNA_REPCONTENT, A.QNA_REPDATE
		FROM (select * from goods natural join qna) A WHERE QNA_CATEGORY = '상품문의' AND MEMBER_NUMBER = #{MEMBER_NUMBER}  AND QNA_REPSTATE ='문의종료' 
		GROUP BY A.QNA_NUMBER, A.GOODS_NUMBER, A.GOODS_NAME, A.GOODS_THUMBNAIL, A.QNA_TITLE, A.QNA_CONTENT, A.QNA_REGDATE, A.QNA_REPSTATE, A.QNA_REPCONTENT, A.QNA_REPDATE ORDER BY QNA_REGDATE DESC
	]]>
	</select>	
<update id="updateRepState" parameterType="hashmap">	
	<![CDATA[
		UPDATE QNA SET QNA_REPSTATE='문의종료' WHERE QNA_NUMBER = #{QNA_NUMBER}
	]]>
	</update>
	
	<insert id="insertQna" parameterType="hashmap">
 <![CDATA[
      INSERT INTO QNA (
         QNA_NUMBER,
         QNA_CATEGORY,
         GOODS_NUMBER,
         MEMBER_NUMBER,
         QNA_PASSWORD,
         QNA_CONTENT,
         QNA_IMAGE1,
         QNA_IMAGE2,
         QNA_REGDATE,
         QNA_RE_LEVEL,
         QNA_RE_STEP,
         QNA_TITLE,
         QNA_REF)
      VALUES 
         (QNA_NUMBER_SEQ.NEXTVAL,
         #{QNA_CATEGORY},
         #{GOODS_NUMBER},
         #{MEMBER_NUMBER},
         #{QNA_PASSWORD},
         #{QNA_IMAGE1},
         #{QNA_IMAGE2},
         SYSDATE,
         0,
         #{QNA_RE_LEVEL},
         #{QNA_RE_STEP},
         #{QNA_TITLE},
         QNA_NUMBER_SEQ.CURRVAL)
   ]]>
	</insert>
	<insert id="insertModalQna" parameterType="hashmap">
 <![CDATA[
      INSERT INTO QNA (QNA_NUMBER, QNA_CATEGORY, GOODS_NUMBER, MEMBER_NUMBER, QNA_PASSWORD, QNA_CONTENT, QNA_REGDATE, QNA_TITLE,  QNA_RE_LEVEL, QNA_RE_STEP, QNA_REF) VALUES 
      (QNA_NUMBER_SEQ.NEXTVAL, #{QNA_CATEGORY}, #{GOODS_NUMBER}, #{MEMBER_NUMBER}, #{QNA_PASSWORD}, #{QNA_CONTENT}, SYSDATE, #{QNA_TITLE}, 0, 0, QNA_NUMBER_SEQ.CURRVAL)
   ]]>
	</insert>
</mapper>