<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="member">
	<select resultType="hashmap" parameterType="hashmap" id="selectMemberList">
	<![CDATA[
		SELECT 
			M.MEMBER_NUMBER,
			M.MEMBER_ID,
			M.MEMBER_NAME,
			M.MEMBER_PHONE,
			M.MEMBER_EMAIL,
			M.MEMBER_ADDRESS1,
			M.MEMBER_ADDRESS2,
			M.MEMBER_REGDATE,
			M.MEMBER_DELDATE,
		SUM (P.POINT_POINT) MEMBER_POINT
		FROM MEMBER M, POINT P
		WHERE MEMBER_ONOFF= '0'
		AND M.MEMBER_NUMBER = P.MEMBER_NUMBER
		GROUP BY 
			M.MEMBER_NUMBER, 
			M.MEMBER_ID, 
			M.MEMBER_NAME,
			M.MEMBER_PHONE,
			M.MEMBER_EMAIL,
			M.MEMBER_ADDRESS1,
			M.MEMBER_ADDRESS2,
			M.MEMBER_REGDATE,
			M.MEMBER_DELDATE
		ORDER BY MEMBER_NUMBER DESC
	]]>
	</select>

	<select resultType="hashmap" parameterType="hashmap" id="selectMemberDetail">
			<![CDATA[
		SELECT
			M.MEMBER_NUMBER,
			M.MEMBER_ID,
			M.MEMBER_PASSWORD,
			M.MEMBER_NAME,
			M.MEMBER_ZIPCODE,
			M.MEMBER_ADDRESS1,
			M.MEMBER_ADDRESS2,
			M.MEMBER_PHONE,
			M.MEMBER_EMAIL,
			M.MEMBER_REGDATE,
			M.MEMBER_DELDATE,
			SUM (P.POINT_POINT) MEMBER_POINT
		FROM MEMBER M, POINT P
		WHERE M.MEMBER_NUMBER = P.MEMBER_NUMBER
		AND M.MEMBER_NUMBER = #{MEMBER_NUMBER}
		GROUP BY 
			M.MEMBER_NUMBER,
			M.MEMBER_ID,
			M.MEMBER_PASSWORD,
			M.MEMBER_NAME,
			M.MEMBER_ZIPCODE,
			M.MEMBER_ADDRESS1,
			M.MEMBER_ADDRESS2,
			M.MEMBER_PHONE,
			M.MEMBER_EMAIL,
			M.MEMBER_REGDATE,
			M.MEMBER_DELDATE
	]]>
	</select>
	
	<select resultType="hashmap" parameterType="hashmap" id="searchMemberId">
			<![CDATA[
		SELECT 
			M.MEMBER_NUMBER,
			M.MEMBER_ID,
			M.MEMBER_NAME,
			M.MEMBER_PHONE,
			M.MEMBER_EMAIL,
			M.MEMBER_ADDRESS1,
			M.MEMBER_ADDRESS2,
			M.MEMBER_REGDATE,
			M.MEMBER_DELDATE,
		SUM (P.POINT_POINT) MEMBER_POINT
		FROM MEMBER M, POINT P
		WHERE MEMBER_ONOFF= #{onOff}
		AND MEMBER_ID like '%' || #{isSearch} || '%'
		AND M.MEMBER_NUMBER = P.MEMBER_NUMBER
		GROUP BY 
			M.MEMBER_NUMBER, 
			M.MEMBER_ID, 
			M.MEMBER_NAME,
			M.MEMBER_PHONE,
			M.MEMBER_EMAIL,
			M.MEMBER_ADDRESS1,
			M.MEMBER_ADDRESS2,
			M.MEMBER_REGDATE,
			M.MEMBER_DELDATE
		ORDER BY MEMBER_NUMBER DESC
	]]>
	</select>
	
	<select resultType="hashmap" parameterType="hashmap" id="searchMemberName">
			<![CDATA[
		SELECT 
			M.MEMBER_NUMBER,
			M.MEMBER_ID,
			M.MEMBER_NAME,
			M.MEMBER_PHONE,
			M.MEMBER_EMAIL,
			M.MEMBER_ADDRESS1,
			M.MEMBER_ADDRESS2,
			M.MEMBER_REGDATE,
			M.MEMBER_DELDATE,
		SUM (P.POINT_POINT) MEMBER_POINT
		FROM MEMBER M, POINT P
		WHERE MEMBER_ONOFF= #{onOff}
		AND MEMBER_NAME like '%' || #{isSearch} || '%'
		AND M.MEMBER_NUMBER = P.MEMBER_NUMBER
		GROUP BY 
			M.MEMBER_NUMBER, 
			M.MEMBER_ID, 
			M.MEMBER_NAME,
			M.MEMBER_PHONE,
			M.MEMBER_EMAIL,
			M.MEMBER_ADDRESS1,
			M.MEMBER_ADDRESS2,
			M.MEMBER_REGDATE,
			M.MEMBER_DELDATE
		ORDER BY MEMBER_NUMBER DESC
	]]>
	</select>
	
	<select resultType="hashmap" parameterType="hashmap" id="searchMemberPhone">
			<![CDATA[
		SELECT 
			M.MEMBER_NUMBER,
			M.MEMBER_ID,
			M.MEMBER_NAME,
			M.MEMBER_PHONE,
			M.MEMBER_EMAIL,
			M.MEMBER_ADDRESS1,
			M.MEMBER_ADDRESS2,
			M.MEMBER_REGDATE,
			M.MEMBER_DELDATE,
		SUM (P.POINT_POINT) MEMBER_POINT
		FROM MEMBER M, POINT P
		WHERE MEMBER_ONOFF= #{onOff}
		AND MEMBER_PHONE like '%' || #{isSearch} || '%'
		AND M.MEMBER_NUMBER = P.MEMBER_NUMBER
		GROUP BY 
			M.MEMBER_NUMBER, 
			M.MEMBER_ID, 
			M.MEMBER_NAME,
			M.MEMBER_PHONE,
			M.MEMBER_EMAIL,
			M.MEMBER_ADDRESS1,
			M.MEMBER_ADDRESS2,
			M.MEMBER_REGDATE,
			M.MEMBER_DELDATE
		ORDER BY MEMBER_NUMBER DESC
	]]>
	</select>
	
	<select resultType="hashmap" parameterType="hashmap" id="searchMemberEmail">
			<![CDATA[
		SELECT 
			M.MEMBER_NUMBER,
			M.MEMBER_ID,
			M.MEMBER_NAME,
			M.MEMBER_PHONE,
			M.MEMBER_EMAIL,
			M.MEMBER_ADDRESS1,
			M.MEMBER_ADDRESS2,
			M.MEMBER_REGDATE,
			M.MEMBER_DELDATE,
		SUM (P.POINT_POINT) MEMBER_POINT
		FROM MEMBER M, POINT P
		WHERE MEMBER_ONOFF= #{onOff}
		AND MEMBER_EMAIL like '%' || #{isSearch} || '%'
		AND M.MEMBER_NUMBER = P.MEMBER_NUMBER
		GROUP BY 
			M.MEMBER_NUMBER, 
			M.MEMBER_ID, 
			M.MEMBER_NAME,
			M.MEMBER_PHONE,
			M.MEMBER_EMAIL,
			M.MEMBER_ADDRESS1,
			M.MEMBER_ADDRESS2,
			M.MEMBER_REGDATE,
			M.MEMBER_DELDATE
		ORDER BY MEMBER_NUMBER DESC
	]]>
	</select>
	
	<update parameterType="hashmap" id="updateMember">
		<![CDATA[
		UPDATE MEMBER
		SET
			MEMBER_PASSWORD = #{MEMBER_PASSWORD},
			MEMBER_NAME = #{MEMBER_NAME},
			MEMBER_ZIPCODE = #{MEMBER_ZIPCODE},
			MEMBER_ADDRESS1 = #{MEMBER_ADDRESS1},
			MEMBER_ADDRESS2 = #{MEMBER_ADDRESS2},
			MEMBER_PHONE = #{MEMBER_PHONE},
			MEMBER_EMAIL = #{MEMBER_EMAIL}
		WHERE MEMBER_NUMBER = #{MEMBER_NUMBER}
		]]>
	</update>
	
	<update parameterType="hashmap" id="deleteMember">
		<![CDATA[
		UPDATE MEMBER
		SET
			MEMBER_DELDATE = SYSDATE,
			MEMBER_ONOFF = '1'
		WHERE MEMBER_NUMBER = #{MEMBER_NUMBER} 
		]]>
	</update>
	
	<update parameterType="hashmap" id="updatePoint">
		<![CDATA[
		INSERT INTO POINT (
			MEMBER_NUMBER,
			POINT_CONTENT,
			POINT_POINT,
			POINT_DATE,
			POINT_NUMBER)
		VALUES
			(#{MEMBER_NUMBER},
			 '관리자',
			 #{POINT_POINT},
			 SYSDATE,
			 POINT_NUMBER_SEQ.NEXTVAL)
		]]>
	</update>
</mapper>